{% extends "base.html" %}
{% load static %}
{% load widget_tweaks %}
{% block head %}
    <link rel="stylesheet"
          href="{% static 'logistics/css/conference_create.css' %}">
    <script src="{% static 'logistics/js/conference_create.js' %}"></script>
{% endblock head %}
{% block content %}
    <div class="container-fluid">
        <h1 class="mb-4">Criar Conferência</h1>
        <form method="post" enctype="multipart/form-data">
            {% csrf_token %}
            {% if form.non_field_errors %}<div class="alert alert-danger">{{ form.non_field_errors }}</div>{% endif %}
            <!-- Forma de criação -->
            <div class="card mb-4">
                <div class="card-body">
                    <h5 class="card-title">Forma de criação</h5>
                    {% for radio in form.creation_mode %}
                        <div class="form-check">
                            {{ radio.tag }}
                            <label class="form-check-label" for="{{ radio.id_for_label }}">{{ radio.choice_label }}</label>
                        </div>
                    {% endfor %}
                </div>
            </div>
            <!-- VIA CT-e -->
            <div id="cte-section" class="card mb-4">
                <div class="card-body">
                    <h5 class="card-title">Importação por CT-e</h5>
                    <div class="mb-3">
                        <label class="form-label" for="{{ form.cte_files.id_for_label }}">Arquivos CT-e</label>
                        {{ form.cte_files|add_class:"form-control" }}
                        {% if form.cte_files.errors %}<div class="invalid-feedback d-block">{{ form.cte_files.errors }}</div>{% endif %}
                        <div class="form-text">Permite importar múltiplos arquivos.</div>
                    </div>
                </div>
            </div>
            <!-- VIA NF-e -->
            <div id="nfe-section" class="card mb-4" style="display:none;">
                <div class="card-body">
                    <h5 class="card-title">Importação por NF-e</h5>
                    <div class="mb-3">
                        <label class="form-label" for="{{ form.nfe_files.id_for_label }}">Arquivos NF-e</label>
                        {{ form.nfe_files|add_class:"form-control" }}
                        {% if form.nfe_files.errors %}<div class="invalid-feedback d-block">{{ form.nfe_files.errors }}</div>{% endif %}
                        <div class="form-text">Permite importar múltiplos arquivos.</div>
                    </div>
                </div>
            </div>
            <!-- CHAVE DE ACESSO -->
            <div id="access-key-section" class="card mb-4" style="display:none;">
                <div class="card-body">
                    <h5 class="card-title">Via chave de acesso</h5>
                    <label class="form-label">Informe a chave de acesso da nota fiscal</label>
                    <div id="access-key-container" class="form-control d-flex flex-wrap gap-2">
                        <input type="text"
                               maxlength="44"
                               id="access-key-input"
                               class="border-0 flex-grow-1"
                               placeholder="Leia a chave e pressione Enter" />
                    </div>
                    <!-- Campo REAL enviado ao Django -->
                    <input type="hidden" name="access_keys" id="access-keys-hidden">
                    <div class="form-text">Permite informar múltiplas chaves de acesso.</div>
                    {% if form.access_key.errors %}<div class="invalid-feedback d-block">{{ form.access_key.errors }}</div>{% endif %}
                </div>
            </div>
            <!-- Entidades -->
            <div class="card mb-4">
                <div class="card-body">
                    <h5 class="card-title">Entidades</h5>
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label class="form-label" for="{{ form.origin.id_for_label }}">Origem</label>
                            {{ form.origin|add_class:"form-select" }}
                            {% if form.origin.errors %}<div class="invalid-feedback d-block">{{ form.origin.errors }}</div>{% endif %}
                        </div>
                        <div class="col-md-6 mb-3">
                            <label class="form-label" for="{{ form.destination.id_for_label }}">Destino</label>
                            {{ form.destination|add_class:"form-select" }}
                            {% if form.destination.errors %}<div class="invalid-feedback d-block">{{ form.destination.errors }}</div>{% endif %}
                        </div>
                        <div class="col-md-6 mb-3">
                            <label class="form-label" for="{{ form.event_type.id_for_label }}">Tipo</label>
                            {{ form.event_type|add_class:"form-select" }}
                            {% if form.event_type.errors %}<div class="invalid-feedback d-block">{{ form.event_type.errors }}</div>{% endif %}
                        </div>
                    </div>
                </div>
            </div>
            <!-- Ações -->
            <div class="d-flex justify-content-end">
                <button type="submit" class="btn btn-primary">Criar Conferência</button>
            </div>
        </form>
    </div>
{% endblock %}
